generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ---- News ----
model NewsBrief {
  id        String   @id @default(uuid())
  title     String
  contentMd String
  source    String   @default("cron")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([createdAt])
}

// ---- Raw transfers (append-only) ----
model StablecoinTransfer {
  id             String   @id @default(uuid())
  chainId         Int
  tokenAddress    String
  txHash          String
  logIndex        Int
  blockNumber     Int
  blockTimestamp  DateTime
  fromAddress     String
  toAddress       String
  amountRaw       String
  decimals        Int
  isMint          Boolean
  isBurn          Boolean
  createdAt       DateTime @default(now())

  @@unique([chainId, txHash, logIndex])
  @@index([chainId, tokenAddress, blockNumber])
  @@index([blockTimestamp])
}

// ---- Hourly metrics ----
model StablecoinMetricHourly {
  id              String   @id @default(uuid())
  bucketStart     DateTime
  chainId         Int
  tokenAddress    String

  supply          String?
  mintAmount      String   @default("0")
  burnAmount      String   @default("0")
  transferAmount  String   @default("0")
  transferCount   Int      @default(0)
  uniqueSenders   Int      @default(0)
  uniqueReceivers Int      @default(0)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@unique([bucketStart, chainId, tokenAddress])
  @@index([chainId, tokenAddress, bucketStart])
}

// ---- Index cursor ----
model IndexCursor {
  id                 String   @id @default(uuid())
  chainId             Int
  tokenAddress        String
  lastFinalizedBlock  Int
  updatedAt           DateTime @updatedAt

  @@unique([chainId, tokenAddress])
}

// ---- Job runs (cron/health) ----
model JobRun {
  id        String   @id @default(uuid())
  name      String
  status    String   // ok|failed
  summary   String?
  runAt     DateTime
  createdAt DateTime @default(now())

  @@index([name, runAt])
}
